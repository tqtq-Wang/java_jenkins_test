pipeline {
    agent any
    
    stages {
        stage('æ£€å‡ºä»£ç ') {
            steps {
                echo 'æ£€å‡ºä»£ç ...'
                checkout scm
            }
        }
        
        stage('æ„å»ºå’Œæµ‹è¯•') {
            steps {
                echo 'ä½¿ç”¨Maven Wrapperæ„å»ºé¡¹ç›®...'
                script {
                    if (isUnix()) {
                        sh 'chmod +x ./mvnw'
                        sh './mvnw clean test package -DskipTests'
                    } else {
                        bat '.\\mvnw.cmd clean test package -DskipTests'
                    }
                }
            }
            post {
                always {
                    // å°è¯•å‘å¸ƒæµ‹è¯•ç»“æœï¼Œå¦‚æœæ²¡æœ‰åˆ™è·³è¿‡
                    script {
                        if (fileExists('target/surefire-reports/*.xml')) {
                            publishTestResults testResultsPattern: 'target/surefire-reports/*.xml'
                        }
                    }
                }
                success {
                    // å½’æ¡£JARæ–‡ä»¶
                    script {
                        if (fileExists('target/*.jar')) {
                            archiveArtifacts artifacts: 'target/*.jar', fingerprint: true
                        }
                    }
                }
            }
        }
        
        stage('å¥åº·æ£€æŸ¥') {
            steps {
                echo 'æ£€æŸ¥æ„å»ºäº§ç‰©...'
                script {
                    if (isUnix()) {
                        sh 'ls -la target/'
                    } else {
                        bat 'dir target\\'
                    }
                }
            }
        }
    }
    
    post {
        always {
            echo 'æ„å»ºæµç¨‹å®Œæˆ'
        }
        success {
            echo 'ğŸ‰ æ„å»ºæˆåŠŸï¼'
            echo 'ç”Ÿæˆçš„JARæ–‡ä»¶ï¼štarget/jenkins-test-1.0.0.jar'
        }
        failure {
            echo 'âŒ æ„å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—'
        }
    }
}
